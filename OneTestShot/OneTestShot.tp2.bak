BACKUP ~weidu_external/OneTestShot/backup~
AUTHOR ~~
VERSION ~~

ALWAYS

	ACTION_IF GAME_IS ~bgt~ BEGIN
		INCLUDE ~OneTestShot/Lib/g3_bgt_cpmvars.tpa~
		PRINT ~Game is BGT~
	END ELSE ACTION_IF (GAME_IS ~eet~ AND NOT MOD_IS_INSTALLED ~EET_END.TP2~ ~0~) BEGIN
		INCLUDE ~OneTestShot/Lib/eet_cpmvars.tpa~
		PRINT ~Game is EET ~
	END ELSE ACTION_IF GAME_IS ~bgee~ BEGIN
		INCLUDE ~OneTestShot/Lib/g3_bgt_cpmvars.tpa~
		PRINT ~Game is BGEE~
	END ELSE ACTION_IF (GAME_IS ~bg2ee~ OR MOD_IS_INSTALLED ~EET_END.TP2~ ~0~ )BEGIN
	OUTER_SPRINT "AJANTIS_JOINED" "AJANTJ"
	OUTER_SPRINT "ALORA_JOINED" "ALORAJ"
	OUTER_SPRINT "BRANWEN_JOINED" "BRANWJ"
	OUTER_SPRINT "CORAN_JOINED" "CORANJ"
	OUTER_SPRINT "DYNAHEIR_JOINED" "DYNAHJ"
	OUTER_SPRINT "EDWIN_JOINED" "EDWINJ"
	OUTER_SPRINT "ELDOTH_JOINED" "ELDOTJ"
	OUTER_SPRINT "FALDORN_JOINED" "FALDOJ"
	OUTER_SPRINT "GARRICK_JOINED" "GARRIJ"
	OUTER_SPRINT "IMOEN_JOINED" "IMOEN2"
	OUTER_SPRINT "JAHEIRA_JOINED" "JAHEIJ"
	OUTER_SPRINT "KAGAIN_JOINED" "KAGAIJ"
	OUTER_SPRINT "KHALID_JOINED" "KHALIJ"
	OUTER_SPRINT "KIVAN_JOINED" "KIVANJ"
	OUTER_SPRINT "MINSC_JOINED" "MINSCJ"
	OUTER_SPRINT "MONTARON_JOINED" "MONTAJ"
	OUTER_SPRINT "QUAYLE_JOINED" "QUAYLJ"
	OUTER_SPRINT "SAFANA_JOINED" "SAFANJ"
	OUTER_SPRINT "SHARTEEL_JOINED" "SHARTJ"
	OUTER_SPRINT "SKIE_JOINED" "SKIEJ"
	OUTER_SPRINT "TIAX_JOINED" "TIAXJ"
	OUTER_SPRINT "VICONIA_JOINED" "VICONJ"
	OUTER_SPRINT "XAN_JOINED" "XANJ"
	OUTER_SPRINT "XZAR_JOINED" "XZARJ"
	OUTER_SPRINT "YESLICK_JOINED" "YESLIJ"
	OUTER_SPRINT "DORN_JOINED" "DORNJ"
	OUTER_SPRINT "NEERA_JOINED" "NEERAJ"
	OUTER_SPRINT "RASAAD_JOINED" "RASAADJ"
	// BCS
	OUTER_SPRINT "AJANTIS_BCS" "AJANTIS"
	OUTER_SPRINT "ALORA_BCS" "ALORA"
	OUTER_SPRINT "BRANWEN_BCS" "BRANWEN"
	OUTER_SPRINT "CORAN_BCS" "CORAN"
	OUTER_SPRINT "DYNAHEIR_BCS" "DYNAHEIR"
	OUTER_SPRINT "EDWIN_BCS" "EDWIN"
	OUTER_SPRINT "ELDOTH_BCS" "ELDOTH"
	OUTER_SPRINT "FALDORN_BCS" "FALDORN"
	OUTER_SPRINT "GARRICK_BCS" "GARRICK"
	OUTER_SPRINT "JAHEIRA_BCS" "JAHEIRA"
	OUTER_SPRINT "KAGAIN_BCS" "KAGAIN"
	OUTER_SPRINT "KHALID_BCS" "KHALID"
	OUTER_SPRINT "KIVAN_BCS" "KIVAN"
	OUTER_SPRINT "MINSC_BCS" "MINSC"
	OUTER_SPRINT "MONTARON_BCS" "MONTARON"
	OUTER_SPRINT "QUAYLE_BCS" "QUAYLE"
	OUTER_SPRINT "SAFANA_BCS" "SAFANA"
	OUTER_SPRINT "SHARTEEL_BCS" "SHARTEEL"
	OUTER_SPRINT "SKIE_BCS" "SKIE"
	OUTER_SPRINT "TIAX_BCS" "TIAX"
	OUTER_SPRINT "VICONIA_BCS" "VICONIA"
	OUTER_SPRINT "XAN_BCS" "XAN"
	OUTER_SPRINT "XZAR_BCS" "XZAR"
	OUTER_SPRINT "YESLICK_BCS" "YESLICK"
	OUTER_SPRINT "DORN_BCS" "DORN"
	OUTER_SPRINT "NEERA_BCS" "NEERA"
	OUTER_SPRINT "RASAAD_BCS" "RASAAD"
	OUTER_SPRINT "IMOEN_JOINED" "IMOEN2"
	OUTER_SPRINT "IMOEN_DV" "imoen2"
	OUTER_SPRINT "IMOEN_BCS" "IMOEN2"
		PRINT ~Game is B2GEE~
	END

END

BEGIN ~All-in~
DESIGNATED 1000
LABEL ~OneTestShot-All-in~

COPY_EXISTING_REGEXP GLOB ~^.+\.bcs$~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(^[%TAB% ]*InParty(Myself)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY ~%textToReplace%~ ~OR(2)
	InParty(Myself)
	Allegiance(Myself,FAMILIAR)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
			PATCH_PRINT ~... // Myself found in %SOURCE_FILESPEC%
			~
		END /*ELSE BEGIN
			PATCH_WARN ~WARNING: could not find Myself in %SOURCE_FILESPEC%~
		END*/
	END
BUT_ONLY

COPY_EXISTING_REGEXP GLOB ~^.+\.bcs$~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~\(^[%TAB% ]*IsValidForPartyDialogue(Myself)\)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~%textToReplace%~ ~InMyArea(Myself)
!StateCheck(Myself,CD_STATE_NOTVALID)
OR(2)
	InParty(Myself)
	Allegiance(Myself,FAMILIAR)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
			PATCH_PRINT ~... // Myself found in %SOURCE_FILESPEC%
			~
		END /*ELSE BEGIN
			PATCH_WARN ~WARNING: could not find Myself in %SOURCE_FILESPEC%~
		END*/
	END
BUT_ONLY

COPY_EXISTING_REGEXP GLOB ~^.+\.dlg$~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~InParty(Myself)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~%textToReplace%~ ~OR(2)
	InParty(Myself)
	Allegiance(Myself,FAMILIAR)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
			PATCH_PRINT ~... // Myself found in %SOURCE_FILESPEC%
			~
		END /*ELSE BEGIN
			PATCH_WARN ~WARNING: could not find Myself in %SOURCE_FILESPEC%~
		END*/
	END
BUT_ONLY

COPY_EXISTING_REGEXP GLOB ~^.+\.dlg$~ ~override~
	DECOMPILE_AND_PATCH BEGIN
		SPRINT textToReplace ~IsValidForPartyDialogue(Myself)~
		COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
		PATCH_IF (num_matches > 0) BEGIN
			REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~%textToReplace%~ ~InMyArea(Myself)
!StateCheck(Myself,CD_STATE_NOTVALID)
OR(2)
	InParty(Myself)
	Allegiance(Myself,FAMILIAR)~
			PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
			PATCH_PRINT ~... // Myself found in %SOURCE_FILESPEC%
			~
		END /*ELSE BEGIN
			PATCH_WARN ~WARNING: could not find Myself in %SOURCE_FILESPEC%~
		END*/
	END
BUT_ONLY

ACTION_FOR_EACH Death_var IN
// Imoen
%IMOEN_DV%
// bg1
Ajantis
Alora
Branwen
Coran
Dynaheir
Edwin
Eldoth
Faldorn
Garrick
Jaheira
Kagain
Khalid
Kivan
Minsc
Montaron
Quayle
Safana
Sharteel
Skie
Tiax
Viconia
Xan
Xzar
Yeslick LK#YESLK
Xan
Dorn
Neera
Rasaad
// SoD
// bg2
Anomen
Korgan
Aerie
Mazzy
Nalia
Keldorn
Cernd
Haerdalis
Valygar
Yoshimo
Jan
Wilson
Hexxat
Sarevok
// Mods
cmninaf callisto // The Undying
BEGIN


	COPY_EXISTING_REGEXP GLOB ~^.+\.bcs$~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			SPRINT textToReplace ~\(^[%TAB% ]*InParty("%Death_var%")\)~
			COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
			PATCH_IF (num_matches > 0) BEGIN
				REPLACE_TEXTUALLY ~%textToReplace%~ ~OR(2)
	InParty("%Death_var%")
	Allegiance("%Death_var%",FAMILIAR)~
				PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
				PATCH_PRINT ~... // %Death_var% found in %SOURCE_FILESPEC%
				~
			END /*ELSE BEGIN
				PATCH_WARN ~WARNING: could not find %Death_var% in %SOURCE_FILESPEC%~
			END*/
		END
	BUT_ONLY


	COPY_EXISTING_REGEXP GLOB ~^.+\.bcs$~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			SPRINT textToReplace ~\(^[%TAB% ]*IsValidForPartyDialogue("%Death_var%")\)~
			COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
			PATCH_IF (num_matches > 0) BEGIN
				REPLACE_TEXTUALLY ~%textToReplace%~ ~InMyArea("%Death_var%")
!StateCheck("%Death_var%",CD_STATE_NOTVALID)
OR(2)
	InParty("%Death_var%")
	Allegiance("%Death_var%",FAMILIAR)~
				PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
				PATCH_PRINT ~... // %Death_var% found in %SOURCE_FILESPEC%
				~
			END /*ELSE BEGIN
				PATCH_WARN ~WARNING: could not find %Death_var% in %SOURCE_FILESPEC%~
			END*/
		END
	BUT_ONLY

	COPY_EXISTING_REGEXP GLOB ~^.+\.dlg$~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			SPRINT textToReplace ~InParty(%Death_var%)~
			COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
			PATCH_IF (num_matches > 0) BEGIN
				REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~%textToReplace%~ ~OR(2)
	InParty("%Death_var%")
	Allegiance("%Death_var%",FAMILIAR)~
				PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
				PATCH_PRINT ~... // %Death_var% found in %SOURCE_FILESPEC%
				~
			END /*ELSE BEGIN
				PATCH_WARN ~WARNING: could not find %Death_var% in %SOURCE_FILESPEC%~
			END*/
		END
	BUT_ONLY

	COPY_EXISTING_REGEXP GLOB ~^.+\.dlg$~ ~override~
		DECOMPILE_AND_PATCH BEGIN
			SPRINT textToReplace ~IsValidForPartyDialogue(%Death_var%)~
			COUNT_REGEXP_INSTANCES ~%textToReplace%~ num_matches
			PATCH_IF (num_matches > 0) BEGIN
				REPLACE_TEXTUALLY CASE_INSENSITIVE EXACT_MATCH ~%textToReplace%~ ~InMyArea("%Death_var%")
!StateCheck("%Death_var%",CD_STATE_NOTVALID)
OR(2)
	InParty("%Death_var%")
	Allegiance("%Death_var%",FAMILIAR)~
				PATCH_PRINT ~Patching: %num_matches% matches found in %SOURCE_FILESPEC% for REPLACE_TEXTUALLY: %textToReplace%~
				PATCH_PRINT ~... // %Death_var% found in %SOURCE_FILESPEC%
				~
			END /*ELSE BEGIN
				PATCH_WARN ~WARNING: could not find %Death_var% in %SOURCE_FILESPEC%~
			END*/
		END
	BUT_ONLY

END

ACTION_FOR_EACH joining_dlg IN
// Imoen
%IMOEN_JOINED% IMOEN25J
// bg1
%AJANTIS_JOINED%
%ALORA_JOINED%
%BRANWEN_JOINED%
%CORAN_JOINED%
%DYNAHEIR_JOINED%
%EDWIN_JOINED% EDWIN25J
%ELDOTH_JOINED%
%FALDORN_JOINED%
%GARRICK_JOINED%
%JAHEIRA_JOINED% JAHEI25J
%KAGAIN_JOINED%
%KHALID_JOINED%
%KIVAN_JOINED%
%MINSC_JOINED% MINSC25J
%MONTARON_JOINED%
%QUAYLE_JOINED%
%SAFANA_JOINED%
%SHARTEEL_JOINED%
%SKIE_JOINED%
%TIAX_JOINED%
%VICONIA_JOINED% VICON25J
%XAN_JOINED%
%XZAR_JOINED%
%YESLICK_JOINED% LK#YESJ LK#YE25J
%DORN_JOINED% DORN25J
%NEERA_JOINED% NEERA25J
%RASAAD_JOINED% RASAA25J
// SoD
// bg2
AERIEJ AERIE25J
ANOMENJ ANOME25J
CERNDJ CERND25J
HAERDAJ HAERD25J
JANJ JAN25J
KELDORJ KELDO25J
KORGANJ KORGA25J
MAZZYJ MAZZY25J
NALIAJ NALIA25J
VALYGARJ VALYG25J
YOSHJ
SAREV25J
WILSONJ
HEXXATJ HEXXA25J
// Mods
CMNINAFJ CMCALLIJ CMNINA25// The Undying
BEGIN

	ACTION_IF FILE_EXISTS_IN_GAME ~%joining_dlg%.dlg~ BEGIN
	
		COMPILE EVALUATE_BUFFER ~OneTestShot/All_In.D~

	END
END

ACTION_FOR_EACH bcs IN
// Imoen
%IMOEN_BCS% IMOE25
// bg1
%AJANTIS_BCS%
%ALORA_BCS% cmalora cmalo25
%BRANWEN_BCS%
%CORAN_BCS%
%DYNAHEIR_BCS%
%EDWIN_BCS% EDWI25
%ELDOTH_BCS%
%FALDORN_BCS%
%GARRICK_BCS%
%JAHEIRA_BCS% JAHE25
%KAGAIN_BCS%
%KHALID_BCS%
%KIVAN_BCS%
%MINSC_BCS% MINS25
%MONTARON_BCS%
%QUAYLE_BCS%
%SAFANA_BCS%
%SHARTEEL_BCS%
%SKIE_BCS%
%TIAX_BCS%
%VICONIA_BCS% VICO25
%XAN_BCS%
%XZAR_BCS%
%YESLICK_BCS% LK#YESL LK#YES25
%DORN_BCS% DORN25
%NEERA_BCS% NEER25
%RASAAD_BCS% RASA25
// SoD
// bg2
AERIE AERI25
ANOMEN ANOM25
CERND CERN25
HAERDALI HAER25
JAN JAN25
KELDORN KELD25
KORGAN KORG25
MAZZY MAZZ25
NALIA NALI25
VALYGAR VALY25
YOSHIMO YOSH25
SAREV25
WILSON
HEXXAT HEXXA25
// Mods
CMNINAF CALLISTO CMNINA25 // The Undying
BEGIN

	ACTION_IF FILE_EXISTS_IN_GAME ~%bcs%.bcs~ BEGIN
	
		EXTEND_BOTTOM ~%bcs%.bcs~ ~OneTestShot/All_In.baf~ EVALUATE_BUFFER

	END
END
 
 COPY ~OneTestShot/JO_JOIN.spl~ ~override~
	SAY NAME1 ~Engagement~
	SAY NAME2 ~Engagement~
	SAY DESC ~Engagement

By the present <CHARNAME> includes a new compagnon in the party !

The only way to break this engagement will involve speaking to talk to the mentioned companion and part ways properly.~
	SAY UNIDENTIFIED_DESC ~Engagement

By the present <CHARNAME> includes a new compagnon in the party !

The only way to break this engagement will involve speaking to talk to the mentioned companion and part ways properly.~
		LPF ADD_SPELL_EFFECT
		INT_VAR
			opcode=139
			parameter1= RESOLVE_STR_REF (~We are now fellow travelers.~)
		END

EXTEND_BOTTOM ~baldur.bcs~ ~OneTestShot/Join_ability.baf~
EXTEND_BOTTOM ~BALDUR25.bcs~ ~OneTestShot/Join_ability.baf~ 
 
 /*
 ACTION_IF GAME_IS ~bgt~ BEGIN
 EXTEND_BOTTOM ~%Candlekeep_BCS%.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~AR0602.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~AR4500.BCS~	~OneTestShot/Join_ability.baf~
	END ELSE ACTION_IF GAME_IS ~eet~ BEGIN
 EXTEND_BOTTOM ~%Candlekeep_BCS%.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~Player3.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~AR0602.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~AR4500.BCS~	~OneTestShot/Join_ability.baf~
	END ELSE ACTION_IF (GAME_IS ~bgee~ AND GAME_INCLUDES ~sod~) BEGIN
 EXTEND_BOTTOM ~%Candlekeep_BCS%.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~Player3.BCS~	~OneTestShot/Join_ability.baf~
	END ELSE ACTION_IF (GAME_IS ~bgee~ AND NOT GAME_INCLUDES ~sod~) BEGIN
 EXTEND_BOTTOM ~%Candlekeep_BCS%.BCS~	~OneTestShot/Join_ability.baf~
	END ELSE ACTION_IF GAME_IS ~bg2ee~BEGIN
 EXTEND_BOTTOM ~AR0602.BCS~	~OneTestShot/Join_ability.baf~
 EXTEND_BOTTOM ~AR4500.BCS~	~OneTestShot/Join_ability.baf~
END
*/